
# Comprehensive API Documentation for E-commerce Platform Frontend

## Base URL
http://localhost:5000/api

---

## 🔐 AUTHENTICATION ENDPOINTS

### POST /auth/register
**Purpose**: Register a new user (customer or store owner)
**Role**: Public access
**Request Body**:
```json
{
  "name": "Ahmed Hassan",
  "email": "ahmed@example.com", 
  "password": "securePassword123",
  "role": "customer" // or "store_owner" or "admin"
}
```
**Success Response (201)**:
```json
{
  "success": true,
  "data": {
    "user": {
      "_id": "60d5ecb8b392c123456789ab",
      "name": "Ahmed Hassan",
      "email": "ahmed@example.com",
      "role": "customer",
      "isActive": true,
      "createdAt": "2023-06-08T10:30:00Z"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "refresh_token_here"
  },
  "message": "User registered successfully"
}
```

### POST /auth/login
**Purpose**: Login user and return authentication token
**Role**: Public access
**Request Body**:
```json
{
  "email": "ahmed@example.com",
  "password": "securePassword123"
}
```
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "user": {
      "_id": "60d5ecb8b392c123456789ab",
      "name": "Ahmed Hassan",
      "email": "ahmed@example.com",
      "role": "store_owner",
      "isActive": true,
      "stores": ["60d5ecb8b392c123456789cd"], // Array of store IDs owned
      "phone": "+966501234567",
      "address": "Riyadh, Saudi Arabia",
      "avatar": "https://example.com/avatar.jpg"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "refresh_token_here"
  },
  "message": "Login successful"
}
```

### GET /auth/me
**Purpose**: Get current user profile with store information
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789ab",
    "name": "Ahmed Hassan",
    "email": "ahmed@example.com",
    "role": "store_owner",
    "isActive": true,
    "stores": ["60d5ecb8b392c123456789cd"], // Array of store IDs owned
    "phone": "+966501234567",
    "address": "Riyadh, Saudi Arabia",
    "avatar": "https://example.com/avatar.jpg",
    "emailVerified": true,
    "twoFactorEnabled": false,
    "lastLogin": "2023-06-08T10:30:00Z"
  }
}
```

### PUT /auth/profile
**Purpose**: Update user profile information
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "name": "Ahmed Ali Hassan",
  "phone": "+966501234567",
  "address": "New address in Jeddah",
  "avatar": "https://example.com/new-avatar.jpg"
}
```

### POST /auth/logout
**Purpose**: Logout user and invalidate token
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "message": "Logged out successfully"
}
```

---

## 🏪 STORE MANAGEMENT ENDPOINTS

### POST /stores
**Purpose**: Create a new store (store owners can have multiple stores)
**Role**: Store owners only
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "name": "متجر الإلكترونيات الحديثة",
  "description": "متجر متخصص في بيع الأجهزة الإلكترونية والتقنية",
  "category": "electronics",
  "logo": "https://example.com/store-logo.jpg",
  "phone": "+966501234567",
  "email": "info@modernelectronics.sa",
  "address": "الرياض، المملكة العربية السعودية",
  "domainSlug": "modern-electronics", // Unique slug for store URL
  "businessLicense": "1234567890", // Business registration number
  "taxNumber": "300123456789003", // VAT number
  "deliverySettings": {
    "freeDeliveryThreshold": 500.00,
    "defaultDeliveryPrice": 25.00,
    "deliveryAreas": [
      {
        "name": "الرياض",
        "price": 25.00,
        "estimatedDays": 2
      },
      {
        "name": "جدة",
        "price": 35.00,
        "estimatedDays": 3
      }
    ]
  }
}
```
**Success Response (201)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789cd",
    "name": "متجر الإلكترونيات الحديثة",
    "description": "متجر متخصص في بيع الأجهزة الإلكترونية والتقنية",
    "category": "electronics",
    "logo": "https://example.com/store-logo.jpg",
    "owner": "60d5ecb8b392c123456789ab",
    "slug": "modern-electronics",
    "isActive": true,
    "isVerified": false, // Pending admin approval
    "rating": 0,
    "reviewsCount": 0,
    "productsCount": 0,
    "followersCount": 0,
    "deliverySettings": {
      "freeDeliveryThreshold": 500.00,
      "defaultDeliveryPrice": 25.00,
      "deliveryAreas": [...]
    },
    "createdAt": "2023-06-08T10:30:00Z"
  },
  "message": "Store created successfully and pending approval"
}
```

### GET /stores/my-stores
**Purpose**: Get all stores owned by current user
**Role**: Store owners only
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "60d5ecb8b392c123456789cd",
      "name": "متجر الإلكترونيات الحديثة",
      "description": "متجر متخصص في بيع الأجهزة الإلكترونية والتقنية",
      "category": "electronics",
      "logo": "https://example.com/store-logo.jpg",
      "slug": "modern-electronics",
      "isActive": true,
      "isVerified": true,
      "rating": 4.5,
      "reviewsCount": 234,
      "productsCount": 45,
      "followersCount": 1250,
      "totalSales": 125000.50,
      "monthlyRevenue": 15000.00,
      "pendingOrders": 12,
      "completedOrders": 345,
      "deliverySettings": {
        "freeDeliveryThreshold": 500.00,
        "defaultDeliveryPrice": 25.00,
        "deliveryAreas": [...]
      },
      "createdAt": "2023-06-08T10:30:00Z"
    }
  ]
}
```

### GET /stores/:storeId
**Purpose**: Get specific store information (for store owner or public)
**Role**: Public access (limited info) / Store owner (full info if owns the store)
**Headers**: `Authorization: Bearer {token}` (optional for public, required for owner info)
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789cd",
    "name": "متجر الإلكترونيات الحديثة",
    "description": "متجر متخصص في بيع الأجهزة الإلكترونية والتقنية",
    "category": "electronics",
    "logo": "https://example.com/store-logo.jpg",
    "owner": {
      "_id": "60d5ecb8b392c123456789ab",
      "name": "Ahmed Hassan",
      "email": "ahmed@example.com" // Only if requesting user is the owner
    },
    "slug": "modern-electronics",
    "isActive": true,
    "isVerified": true,
    "rating": 4.5,
    "reviewsCount": 234,
    "productsCount": 45,
    "followersCount": 1250,
    "totalSales": 125000.50, // Only if owner
    "monthlyRevenue": 15000.00, // Only if owner
    "pendingOrders": 12, // Only if owner
    "completedOrders": 345, // Only if owner
    "deliverySettings": {
      "freeDeliveryThreshold": 500.00,
      "defaultDeliveryPrice": 25.00,
      "deliveryAreas": [...]
    },
    "createdAt": "2023-06-08T10:30:00Z"
  }
}
```

### PUT /stores/:storeId
**Purpose**: Update store information (only store owner)
**Role**: Store owners (own stores only)
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "name": "متجر الإلكترونيات المحدث",
  "description": "وصف محدث للمتجر",
  "logo": "https://example.com/new-logo.jpg",
  "phone": "+966501234568",
  "email": "newemail@modernelectronics.sa",
  "deliverySettings": {
    "freeDeliveryThreshold": 600.00,
    "defaultDeliveryPrice": 30.00,
    "deliveryAreas": [
      {
        "name": "الرياض",
        "price": 30.00,
        "estimatedDays": 1
      }
    ]
  }
}
```

### DELETE /stores/:storeId
**Purpose**: Delete/deactivate store (only store owner)
**Role**: Store owners (own stores only)
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "message": "Store deactivated successfully"
}
```

### GET /stores/:storeId/orders
**Purpose**: Get all orders for a specific store with detailed information
**Role**: Store owners (own stores only)
**Headers**: `Authorization: Bearer {token}`
**Query Parameters**:
- `status`: pending, confirmed, preparing, shipped, delivered, cancelled
- `page`: number (default: 1)
- `limit`: number (default: 10)
- `startDate`: ISO date string
- `endDate`: ISO date string
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "60d5ecb8b392c123456789ef",
      "orderNumber": "ORD-2023-001234",
      "customer": {
        "_id": "60d5ecb8b392c123456789gh",
        "name": "محمد أحمد",
        "email": "mohammed@example.com",
        "phone": "+966501234567"
      },
      "items": [
        {
          "product": {
            "_id": "60d5ecb8b392c123456789ij",
            "name": "iPhone 14 Pro",
            "images": ["https://example.com/iphone.jpg"]
          },
          "quantity": 1,
          "price": 4500.00,
          "total": 4500.00
        }
      ],
      "totalAmount": 4500.00,
      "shippingCost": 25.00,
      "taxAmount": 675.00,
      "finalTotal": 5200.00,
      "status": "pending",
      "paymentStatus": "paid",
      "paymentMethod": "credit_card",
      "shippingAddress": {
        "fullName": "محمد أحمد",
        "phone": "+966501234567",
        "address": "شارع الملك فهد، الرياض",
        "city": "الرياض",
        "postalCode": "12345",
        "country": "Saudi Arabia"
      },
      "estimatedDelivery": "2023-06-10T00:00:00Z",
      "trackingNumber": "TRK123456789",
      "notes": "يرجى التوصيل في المساء",
      "deliveryArea": {
        "name": "الرياض",
        "price": 25.00,
        "estimatedDays": 2
      },
      "createdAt": "2023-06-08T10:30:00Z",
      "updatedAt": "2023-06-08T10:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 156,
    "pages": 16
  }
}
```

### PATCH /stores/:storeId/orders/:orderId/status
**Purpose**: Update order status (triggers customer notifications automatically)
**Role**: Store owners (own stores only)
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "status": "confirmed", // pending, confirmed, preparing, shipped, delivered, cancelled
  "trackingNumber": "TRK123456789", // Required for "shipped" status
  "estimatedDelivery": "2023-06-10T00:00:00Z", // Optional
  "notes": "Your order has been confirmed and will be prepared shortly",
  "deliveryCompany": "aramex", // Optional: aramex, smsa, naqel
  "actualDeliveryPrice": 25.00 // Optional: if different from estimated
}
```
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789ef",
    "status": "confirmed",
    "trackingNumber": "TRK123456789",
    "estimatedDelivery": "2023-06-10T00:00:00Z",
    "updatedAt": "2023-06-08T11:00:00Z"
  },
  "message": "Order status updated successfully. Customer notification sent."
}
```
**Backend Notification Trigger**: When status is updated, automatically create notification for customer:
```json
{
  "recipient": "customer_id",
  "type": "order_status_update",
  "title": "تم تحديث حالة طلبك",
  "message": "تم تأكيد طلبك رقم ORD-2023-001234",
  "data": {
    "orderId": "60d5ecb8b392c123456789ef",
    "orderNumber": "ORD-2023-001234",
    "newStatus": "confirmed",
    "trackingNumber": "TRK123456789"
  },
  "priority": "high"
}
```

---

## 📦 PRODUCT MANAGEMENT ENDPOINTS

### POST /stores/:storeId/products
**Purpose**: Create a new product in a specific store
**Role**: Store owners (own stores only)
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "name": "iPhone 14 Pro",
  "description": "أحدث إصدار من آيفون مع كاميرا محسنة وأداء فائق",
  "price": 4500.00,
  "originalPrice": 5000.00,
  "category": "smartphones",
  "brand": "Apple",
  "stock": 50,
  "images": [
    "https://example.com/iphone1.jpg",
    "https://example.com/iphone2.jpg"
  ],
  "specifications": {
    "storage": "256GB",
    "color": "Deep Purple",
    "warranty": "1 year",
    "screenSize": "6.1 inch"
  },
  "tags": ["smartphone", "apple", "iphone", "mobile"],
  "weight": 0.206,
  "dimensions": {
    "length": 147.5,
    "width": 71.5,
    "height": 7.85
  },
  "sku": "IPH14-PRO-256-PURPLE",
  "deliverySettings": {
    "customDeliveryPrice": 30.00, // Override store default
    "expressDelivery": {
      "available": true,
      "price": 50.00,
      "estimatedDays": 1
    },
    "freeDeliveryThreshold": 500.00
  }
}
```
**Success Response (201)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789ij",
    "name": "iPhone 14 Pro",
    "price": 4500.00,
    "store": "60d5ecb8b392c123456789cd",
    "isActive": true,
    "views": 0,
    "soldCount": 0,
    "deliverySettings": {
      "customDeliveryPrice": 30.00,
      "expressDelivery": {
        "available": true,
        "price": 50.00,
        "estimatedDays": 1
      }
    },
    "createdAt": "2023-06-08T10:30:00Z"
  },
  "message": "Product created successfully"
}
```

### GET /stores/:storeId/products
**Purpose**: Get all products for a specific store
**Role**: Public access (for browsing) / Store owner (for management)
**Headers**: `Authorization: Bearer {token}` (optional for public)
**Query Parameters**:
- `category`: string
- `search`: string
- `sort`: newest, price-low, price-high, rating, name
- `page`: number
- `limit`: number
- `includeInactive`: boolean (only for store owners)
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "60d5ecb8b392c123456789ij",
      "name": "iPhone 14 Pro",
      "description": "أحدث إصدار من آيفون",
      "price": 4500.00,
      "originalPrice": 5000.00,
      "discount": 10,
      "images": ["https://example.com/iphone1.jpg", "https://example.com/iphone2.jpg"],
      "category": "smartphones",
      "brand": "Apple",
      "stock": 25,
      "rating": 4.8,
      "reviewsCount": 156,
      "store": {
        "_id": "60d5ecb8b392c123456789cd",
        "name": "متجر الإلكترونيات الحديثة",
        "slug": "modern-electronics"
      },
      "specifications": {
        "storage": "256GB",
        "color": "Deep Purple",
        "warranty": "1 year"
      },
      "isAvailable": true,
      "views": 1250, // Only for store owner
      "soldCount": 45, // Only for store owner
      "revenue": 202500.00, // Only for store owner
      "deliverySettings": {
        "customDeliveryPrice": 30.00,
        "expressDelivery": {
          "available": true,
          "price": 50.00,
          "estimatedDays": 1
        }
      },
      "createdAt": "2023-06-08T10:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 12,
    "total": 45,
    "pages": 4
  }
}
```

### GET /products/:productId
**Purpose**: Get detailed product information
**Role**: Public access
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789ij",
    "name": "iPhone 14 Pro",
    "description": "أحدث إصدار من آيفون مع كاميرا محسنة وأداء فائق",
    "price": 4500.00,
    "originalPrice": 5000.00,
    "discount": 10,
    "images": ["https://example.com/iphone1.jpg", "https://example.com/iphone2.jpg"],
    "category": "smartphones",
    "brand": "Apple",
    "stock": 25,
    "rating": 4.8,
    "reviewsCount": 156,
    "store": {
      "_id": "60d5ecb8b392c123456789cd",
      "name": "متجر الإلكترونيات الحديثة",
      "slug": "modern-electronics",
      "logo": "https://example.com/store-logo.jpg",
      "rating": 4.5,
      "isVerified": true,
      "deliverySettings": {
        "freeDeliveryThreshold": 500.00,
        "defaultDeliveryPrice": 25.00,
        "deliveryAreas": [...]
      }
    },
    "specifications": {
      "storage": "256GB",
      "color": "Deep Purple",
      "warranty": "1 year",
      "screenSize": "6.1 inch"
    },
    "tags": ["smartphone", "apple", "iphone", "mobile"],
    "views": 1250,
    "soldCount": 45,
    "isAvailable": true,
    "estimatedDelivery": "2-3 days",
    "deliveryOptions": [
      {
        "type": "standard",
        "price": 30.00,
        "estimatedDays": 3,
        "description": "التوصيل العادي"
      },
      {
        "type": "express",
        "price": 50.00,
        "estimatedDays": 1,
        "description": "التوصيل السريع"
      }
    ],
    "returnPolicy": "30 days return policy",
    "warranty": "1 year manufacturer warranty",
    "createdAt": "2023-06-08T10:30:00Z"
  }
}
```

### PUT /products/:productId
**Purpose**: Update product information
**Role**: Store owners (own products only)
**Headers**: `Authorization: Bearer {token}`
**Request Body**: Same as create product (all fields optional)
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789ij",
    "name": "iPhone 14 Pro - Updated",
    "price": 4200.00,
    "stock": 30,
    "updatedAt": "2023-06-08T11:00:00Z"
  },
  "message": "Product updated successfully"
}
```

### DELETE /products/:productId
**Purpose**: Delete/deactivate product
**Role**: Store owners (own products only)
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "message": "Product deleted successfully"
}
```

---

## 🛒 ORDER MANAGEMENT ENDPOINTS

### POST /orders
**Purpose**: Create a new order (customers only)
**Role**: Authenticated customers
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "items": [
    {
      "product": "60d5ecb8b392c123456789ij",
      "quantity": 1,
      "price": 4500.00,
      "deliveryOption": "standard" // or "express"
    }
  ],
  "shippingAddress": {
    "fullName": "محمد أحمد",
    "phone": "+966501234567",
    "address": "شارع الملك فهد، الرياض",
    "city": "الرياض",
    "postalCode": "12345",
    "country": "Saudi Arabia"
  },
  "paymentMethod": "credit_card",
  "paymentDetails": {
    "cardToken": "tok_1234567890",
    "saveCard": false
  },
  "totalAmount": 4500.00,
  "shippingCost": 25.00,
  "taxAmount": 675.00,
  "finalTotal": 5200.00,
  "notes": "يرجى التوصيل في المساء",
  "couponCode": "SAVE10"
}
```
**Success Response (201)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789ef",
    "orderNumber": "ORD-2023-001234",
    "status": "pending",
    "paymentStatus": "paid",
    "estimatedDelivery": "2023-06-10T00:00:00Z",
    "trackingNumber": null,
    "finalTotal": 5200.00
  },
  "message": "Order created successfully. Store owner has been notified."
}
```
**Backend Notification Trigger**: Automatically create notification for store owner:
```json
{
  "recipient": "store_owner_id",
  "type": "new_order",
  "title": "طلب جديد",
  "message": "لديك طلب جديد من محمد أحمد بقيمة 5200 ر.س",
  "data": {
    "orderId": "60d5ecb8b392c123456789ef",
    "orderNumber": "ORD-2023-001234",
    "customerName": "محمد أحمد",
    "amount": 5200.00,
    "storeId": "60d5ecb8b392c123456789cd",
    "storeName": "متجر الإلكترونيات الحديثة"
  },
  "priority": "high"
}
```

### GET /orders/my-orders
**Purpose**: Get customer's order history
**Role**: Authenticated customers
**Headers**: `Authorization: Bearer {token}`
**Query Parameters**:
- `status`: all, pending, confirmed, preparing, shipped, delivered, cancelled
- `page`: number
- `limit`: number
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "60d5ecb8b392c123456789ef",
      "orderNumber": "ORD-2023-001234",
      "store": {
        "_id": "60d5ecb8b392c123456789cd",
        "name": "متجر الإلكترونيات الحديثة",
        "logo": "https://example.com/store-logo.jpg"
      },
      "items": [
        {
          "product": {
            "_id": "60d5ecb8b392c123456789ij",
            "name": "iPhone 14 Pro",
            "images": ["https://example.com/iphone.jpg"]
          },
          "quantity": 1,
          "price": 4500.00,
          "total": 4500.00
        }
      ],
      "totalAmount": 4500.00,
      "shippingCost": 25.00,
      "taxAmount": 675.00,
      "finalTotal": 5200.00,
      "status": "shipped",
      "paymentStatus": "paid",
      "trackingNumber": "TRK123456789",
      "estimatedDelivery": "2023-06-10T00:00:00Z",
      "canCancel": false, // false if shipped/delivered
      "canReturn": true, // true if delivered and within return period
      "deliveryDetails": {
        "company": "aramex",
        "estimatedDays": 2,
        "actualDeliveryDate": null
      },
      "createdAt": "2023-06-08T10:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 25,
    "pages": 3
  }
}
```

### GET /orders/:orderId
**Purpose**: Get detailed order information
**Role**: Authenticated users (customers for their orders, store owners for their store orders)
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789ef",
    "orderNumber": "ORD-2023-001234",
    "customer": {
      "_id": "60d5ecb8b392c123456789gh",
      "name": "محمد أحمد",
      "email": "mohammed@example.com", // Only for store owner
      "phone": "+966501234567"
    },
    "store": {
      "_id": "60d5ecb8b392c123456789cd",
      "name": "متجر الإلكترونيات الحديثة"
    },
    "items": [...],
    "status": "shipped",
    "statusHistory": [
      {
        "status": "pending",
        "timestamp": "2023-06-08T10:30:00Z",
        "note": "Order placed"
      },
      {
        "status": "confirmed",
        "timestamp": "2023-06-08T11:00:00Z",
        "note": "Order confirmed by store"
      },
      {
        "status": "shipped",
        "timestamp": "2023-06-09T09:00:00Z",
        "note": "Order shipped via Aramex"
      }
    ],
    "deliveryDetails": {
      "company": "aramex",
      "trackingNumber": "TRK123456789",
      "estimatedDelivery": "2023-06-10T00:00:00Z",
      "actualDelivery": null,
      "deliveryAttempts": []
    },
    "paymentDetails": {
      "method": "credit_card",
      "status": "paid",
      "paidAt": "2023-06-08T10:35:00Z",
      "transactionId": "TXN123456789"
    }
  }
}
```

### PATCH /orders/:orderId/cancel
**Purpose**: Cancel order (customers only, before shipping)
**Role**: Authenticated customers
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "reason": "Changed my mind",
  "refundMethod": "original_payment" // or "store_credit"
}
```
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "status": "cancelled",
    "refundStatus": "processing",
    "refundAmount": 5200.00
  },
  "message": "Order cancelled successfully. Refund is being processed."
}
```
**Backend Notification Trigger**: Notify store owner about cancellation:
```json
{
  "recipient": "store_owner_id",
  "type": "order_cancelled",
  "title": "تم إلغاء طلب",
  "message": "تم إلغاء الطلب رقم ORD-2023-001234",
  "data": {
    "orderId": "60d5ecb8b392c123456789ef",
    "orderNumber": "ORD-2023-001234",
    "reason": "Changed my mind"
  },
  "priority": "medium"
}
```

---

## 🔔 NOTIFICATION ENDPOINTS

### GET /notifications
**Purpose**: Get user notifications (orders, store updates, etc.)
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Query Parameters**:
- `type`: all, order_status_update, new_order, payment_received, delivery_update
- `isRead`: true, false
- `page`: number
- `limit`: number
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "60d5ecb8b392c123456789no",
      "type": "order_status_update",
      "title": "تم شحن طلبك",
      "message": "تم شحن طلبك رقم ORD-2023-001234 وسيصل خلال يومين",
      "data": {
        "orderId": "60d5ecb8b392c123456789ef",
        "orderNumber": "ORD-2023-001234",
        "trackingNumber": "TRK123456789",
        "estimatedDelivery": "2023-06-10T00:00:00Z",
        "deliveryCompany": "aramex"
      },
      "isRead": false,
      "priority": "high", // low, medium, high
      "actionUrl": "/orders/60d5ecb8b392c123456789ef", // Frontend route to redirect
      "createdAt": "2023-06-08T10:30:00Z"
    },
    {
      "_id": "60d5ecb8b392c123456789pq",
      "type": "new_order", // For store owners
      "title": "طلب جديد",
      "message": "لديك طلب جديد من محمد أحمد بقيمة 5200 ر.س",
      "data": {
        "orderId": "60d5ecb8b392c123456789ef",
        "orderNumber": "ORD-2023-001234",
        "customerName": "محمد أحمد",
        "amount": 5200.00,
        "storeId": "60d5ecb8b392c123456789cd",
        "storeName": "متجر الإلكترونيات الحديثة",
        "urgency": "high", // Customer paid, needs immediate attention
        "itemsCount": 1
      },
      "isRead": false,
      "priority": "high",
      "actionUrl": "/store-management?tab=orders&orderId=60d5ecb8b392c123456789ef",
      "createdAt": "2023-06-08T10:30:00Z"
    },
    {
      "_id": "60d5ecb8b392c123456789rs",
      "type": "low_stock_alert", // For store owners
      "title": "تحذير: مخزون منخفض",
      "message": "المنتج iPhone 14 Pro أوشك على النفاد (5 قطع متبقية)",
      "data": {
        "productId": "60d5ecb8b392c123456789ij",
        "productName": "iPhone 14 Pro",
        "currentStock": 5,
        "threshold": 10,
        "storeId": "60d5ecb8b392c123456789cd"
      },
      "isRead": false,
      "priority": "medium",
      "actionUrl": "/store-management?tab=products&productId=60d5ecb8b392c123456789ij",
      "createdAt": "2023-06-08T10:30:00Z"
    }
  ],
  "unreadCount": 5,
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 45,
    "pages": 3
  }
}
```

### PATCH /notifications/:notificationId/read
**Purpose**: Mark notification as read
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789no",
    "isRead": true,
    "readAt": "2023-06-08T11:00:00Z"
  }
}
```

### PATCH /notifications/mark-all-read
**Purpose**: Mark all notifications as read
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "markedCount": 5
  },
  "message": "All notifications marked as read"
}
```

### DELETE /notifications/:notificationId
**Purpose**: Delete notification
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "message": "Notification deleted successfully"
}
```

---

## 📊 ANALYTICS & REPORTS ENDPOINTS

### GET /stores/:storeId/analytics
**Purpose**: Get store analytics dashboard data
**Role**: Store owners (own stores only)
**Headers**: `Authorization: Bearer {token}`
**Query Parameters**:
- `period`: today, week, month, year, custom
- `startDate`: ISO date string (required if period=custom)
- `endDate`: ISO date string (required if period=custom)
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "overview": {
      "totalRevenue": 125000.50,
      "totalOrders": 345,
      "totalProducts": 45,
      "averageOrderValue": 362.32,
      "conversionRate": 3.2,
      "returnRate": 2.1,
      "customerSatisfaction": 4.5,
      "repeatCustomerRate": 25.8
    },
    "revenueChart": [
      {
        "date": "2023-06-01",
        "revenue": 5200.00,
        "orders": 12,
        "newCustomers": 8,
        "returningCustomers": 4
      },
      {
        "date": "2023-06-02",
        "revenue": 6800.00,
        "orders": 15,
        "newCustomers": 10,
        "returningCustomers": 5
      }
    ],
    "topProducts": [
      {
        "_id": "60d5ecb8b392c123456789ij",
        "name": "iPhone 14 Pro",
        "revenue": 67500.00,
        "orders": 15,
        "views": 1250,
        "conversionRate": 1.2,
        "profit": 22500.00
      }
    ],
    "orderStatusDistribution": {
      "pending": 12,
      "confirmed": 25,
      "preparing": 18,
      "shipped": 35,
      "delivered": 245,
      "cancelled": 10,
      "returned": 5
    },
    "deliveryPerformance": {
      "onTimeDeliveries": 92.5,
      "averageDeliveryTime": 2.3,
      "deliveryIssues": 8,
      "customerFeedback": {
        "excellent": 70,
        "good": 20,
        "average": 8,
        "poor": 2
      }
    },
    "customerGeographics": [
      {
        "city": "الرياض",
        "orders": 120,
        "revenue": 45000.00
      },
      {
        "city": "جدة",
        "orders": 80,
        "revenue": 30000.00
      }
    ]
  }
}
```

### GET /analytics/delivery-performance/:storeId
**Purpose**: Get detailed delivery analytics for store
**Role**: Store owners (own stores only)
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "deliveryMetrics": {
      "totalDeliveries": 345,
      "successfulDeliveries": 320,
      "failedDeliveries": 15,
      "pendingDeliveries": 10,
      "averageDeliveryTime": 2.3,
      "onTimePercentage": 92.5
    },
    "deliveryCompanies": [
      {
        "name": "aramex",
        "orders": 150,
        "successRate": 95.0,
        "averageTime": 2.1,
        "cost": 3750.00
      },
      {
        "name": "smsa",
        "orders": 100,
        "successRate": 88.0,
        "averageTime": 2.8,
        "cost": 2500.00
      }
    ],
    "deliveryAreas": [
      {
        "area": "الرياض",
        "orders": 120,
        "averageTime": 1.8,
        "successRate": 96.0,
        "cost": 3000.00
      }
    ],
    "issuesAndReturns": {
      "deliveryIssues": 15,
      "returns": 5,
      "complaints": 3,
      "commonIssues": [
        {
          "issue": "عنوان غير صحيح",
          "count": 8
        },
        {
          "issue": "العميل غير متواجد",
          "count": 5
        }
      ]
    }
  }
}
```

---

## 🔍 SEARCH & DISCOVERY ENDPOINTS

### GET /products
**Purpose**: Public product search and listing
**Role**: Public access
**Query Parameters**:
- `search`: string (product name, description)
- `category`: string
- `store`: string (store ID or slug)
- `minPrice`: number
- `maxPrice`: number
- `brand`: string
- `rating`: number (minimum rating)
- `hasDiscount`: boolean
- `inStock`: boolean
- `freeDelivery`: boolean
- `expressDelivery`: boolean
- `sort`: newest, price-low, price-high, rating, popularity, best-seller
- `page`: number
- `limit`: number
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "60d5ecb8b392c123456789ij",
      "name": "iPhone 14 Pro",
      "price": 4500.00,
      "originalPrice": 5000.00,
      "discount": 10,
      "images": ["https://example.com/iphone.jpg"],
      "rating": 4.8,
      "reviewsCount": 156,
      "store": {
        "_id": "60d5ecb8b392c123456789cd",
        "name": "متجر الإلكترونيات الحديثة",
        "slug": "modern-electronics",
        "isVerified": true,
        "rating": 4.5
      },
      "deliveryInfo": {
        "standardPrice": 30.00,
        "expressPrice": 50.00,
        "freeDeliveryThreshold": 500.00,
        "estimatedDays": 2
      },
      "badges": ["best-seller", "free-delivery-eligible"],
      "isAvailable": true
    }
  ],
  "filters": {
    "categories": [
      {
        "id": "smartphones",
        "name": "الهواتف الذكية",
        "count": 45
      }
    ],
    "brands": [
      {
        "name": "Apple",
        "count": 12
      }
    ],
    "priceRanges": [
      {
        "min": 0,
        "max": 1000,
        "count": 23
      }
    ]
  },
  "pagination": {
    "page": 1,
    "limit": 12,
    "total": 1250,
    "pages": 105
  }
}
```

### GET /stores
**Purpose**: Public store search and listing
**Role**: Public access
**Query Parameters**:
- `search`: string
- `category`: string
- `rating`: number
- `verified`: boolean
- `hasProducts`: boolean
- `deliveryAreas`: string (city name)
- `sort`: newest, rating, popularity, orders
- `page`: number
- `limit`: number
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "60d5ecb8b392c123456789cd",
      "name": "متجر الإلكترونيات الحديثة",
      "description": "متجر متخصص في بيع الأجهزة الإلكترونية",
      "category": "electronics",
      "logo": "https://example.com/store-logo.jpg",
      "slug": "modern-electronics",
      "rating": 4.5,
      "reviewsCount": 234,
      "productsCount": 45,
      "followersCount": 1250,
      "isVerified": true,
      "deliveryInfo": {
        "areas": ["الرياض", "جدة", "الدمام"],
        "freeDeliveryThreshold": 500.00,
        "averageDeliveryTime": 2
      },
      "joinedDate": "2023-01-15T00:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 12,
    "total": 145,
    "pages": 13
  }
}
```

### GET /categories
**Purpose**: Get all product/store categories with statistics
**Role**: Public access
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "electronics",
      "name": "الإلكترونيات",
      "nameEn": "Electronics",
      "icon": "📱",
      "description": "أجهزة إلكترونية وتقنية",
      "image": "https://example.com/category-electronics.jpg",
      "productsCount": 1250,
      "storesCount": 45,
      "averagePrice": 850.00,
      "topBrands": ["Apple", "Samsung", "Huawei"],
      "subcategories": [
        {
          "_id": "smartphones",
          "name": "الهواتف الذكية",
          "nameEn": "Smartphones",
          "productsCount": 450,
          "averagePrice": 1200.00
        },
        {
          "_id": "laptops",
          "name": "أجهزة الكمبيوتر المحمولة",
          "nameEn": "Laptops",
          "productsCount": 200,
          "averagePrice": 2500.00
        }
      ]
    }
  ]
}
```

---

## 📱 REVIEWS & RATINGS ENDPOINTS

### POST /products/:productId/reviews
**Purpose**: Add product review (only customers who purchased)
**Role**: Authenticated customers (must have purchased the product)
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "rating": 5,
  "title": "منتج ممتاز",
  "comment": "جودة عالية وسرعة في التوصيل",
  "pros": ["جودة عالية", "سرعة التوصيل", "سعر مناسب"],
  "cons": ["العبوة يمكن تحسينها"],
  "images": ["https://example.com/review1.jpg"],
  "wouldRecommend": true,
  "deliveryRating": 5, // Rate delivery experience
  "valueForMoney": 4 // Rate value for money
}
```
**Success Response (201)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789tu",
    "user": {
      "name": "محمد أحمد",
      "avatar": "https://example.com/avatar.jpg"
    },
    "rating": 5,
    "title": "منتج ممتاز",
    "isVerifiedPurchase": true,
    "createdAt": "2023-06-08T10:30:00Z"
  },
  "message": "Review added successfully"
}
```
**Backend Notification Trigger**: Notify store owner about new review:
```json
{
  "recipient": "store_owner_id",
  "type": "new_review",
  "title": "تقييم جديد",
  "message": "حصل منتجك iPhone 14 Pro على تقييم 5 نجوم",
  "data": {
    "productId": "60d5ecb8b392c123456789ij",
    "productName": "iPhone 14 Pro",
    "rating": 5,
    "reviewId": "60d5ecb8b392c123456789tu"
  },
  "priority": "medium"
}
```

### GET /products/:productId/reviews
**Purpose**: Get product reviews with filtering
**Role**: Public access
**Query Parameters**:
- `page`: number
- `limit`: number
- `rating`: number (filter by rating)
- `verified`: boolean (only verified purchases)
- `sort`: newest, oldest, helpful, rating-high, rating-low
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "60d5ecb8b392c123456789tu",
      "user": {
        "_id": "60d5ecb8b392c123456789gh",
        "name": "محمد أحمد",
        "avatar": "https://example.com/avatar.jpg"
      },
      "rating": 5,
      "title": "منتج ممتاز",
      "comment": "جودة عالية وسرعة في التوصيل",
      "pros": ["جودة عالية", "سرعة التوصيل"],
      "cons": ["العبوة يمكن تحسينها"],
      "images": ["https://example.com/review1.jpg"],
      "wouldRecommend": true,
      "isVerifiedPurchase": true,
      "deliveryRating": 5,
      "valueForMoney": 4,
      "helpfulCount": 12,
      "createdAt": "2023-06-08T10:30:00Z"
    }
  ],
  "summary": {
    "averageRating": 4.8,
    "totalReviews": 156,
    "ratingDistribution": {
      "5": 120,
      "4": 25,
      "3": 8,
      "2": 2,
      "1": 1
    },
    "verifiedPurchases": 145
  },
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 156,
    "pages": 16
  }
}
```

### POST /stores/:storeId/reviews
**Purpose**: Add store review
**Role**: Authenticated customers (must have made a purchase)
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "rating": 5,
  "title": "متجر ممتاز",
  "comment": "خدمة عملاء ممتازة وتوصيل سريع",
  "serviceRating": 5,
  "deliveryRating": 4,
  "productQualityRating": 5,
  "wouldRecommend": true
}
```

---

## 🛒 CART ENDPOINTS

### GET /cart
**Purpose**: Get user's cart with delivery calculations
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ecb8b392c123456789rs",
    "user": "60d5ecb8b392c123456789ab",
    "items": [
      {
        "_id": "60d5ecb8b392c123456789tu",
        "product": {
          "_id": "60d5ecb8b392c123456789ij",
          "name": "iPhone 14 Pro",
          "price": 4500.00,
          "images": ["https://example.com/iphone.jpg"],
          "stock": 25,
          "store": {
            "_id": "60d5ecb8b392c123456789cd",
            "name": "متجر الإلكترونيات الحديثة",
            "deliverySettings": {
              "freeDeliveryThreshold": 500.00,
              "defaultDeliveryPrice": 25.00
            }
          }
        },
        "quantity": 2,
        "price": 4500.00,
        "total": 9000.00,
        "deliveryOptions": [
          {
            "type": "standard",
            "price": 30.00,
            "estimatedDays": 3
          },
          {
            "type": "express",
            "price": 50.00,
            "estimatedDays": 1
          }
        ],
        "selectedDeliveryOption": "standard",
        "addedAt": "2023-06-08T10:30:00Z"
      }
    ],
    "itemsCount": 2,
    "subtotal": 9000.00,
    "deliverySummary": {
      "standardDelivery": 30.00,
      "expressDelivery": 50.00,
      "freeDeliveryEligible": true,
      "estimatedTax": 1350.00
    },
    "estimatedTotal": {
      "withStandardDelivery": 10380.00,
      "withExpressDelivery": 10400.00,
      "withFreeDelivery": 10350.00
    },
    "availableCoupons": [
      {
        "code": "SAVE10",
        "discount": 10,
        "minAmount": 500.00
      }
    ],
    "updatedAt": "2023-06-08T10:30:00Z"
  }
}
```

### POST /cart/add
**Purpose**: Add item to cart with delivery preferences
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "productId": "60d5ecb8b392c123456789ij",
  "quantity": 1,
  "deliveryOption": "standard", // or "express"
  "selectedVariant": {
    "color": "Deep Purple",
    "storage": "256GB"
  }
}
```
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "itemId": "60d5ecb8b392c123456789tu",
    "cartItemsCount": 3,
    "cartTotal": 13500.00
  },
  "message": "Item added to cart successfully"
}
```

### PUT /cart/update/:itemId
**Purpose**: Update cart item quantity or delivery option
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "quantity": 3,
  "deliveryOption": "express"
}
```

### DELETE /cart/remove/:itemId
**Purpose**: Remove item from cart
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "cartItemsCount": 2,
    "cartTotal": 9000.00
  },
  "message": "Item removed from cart"
}
```

### POST /cart/apply-coupon
**Purpose**: Apply coupon code to cart
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "couponCode": "SAVE10"
}
```

---

## 📸 FILE UPLOAD ENDPOINTS

### POST /upload/image
**Purpose**: Upload single image (products, store logos, user avatars)
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Content-Type**: `multipart/form-data`
**Form Data**: 
- `image: File` (required)
- `type: string` (optional: product, store_logo, avatar, review)
- `maxWidth: number` (optional: auto-resize)
- `quality: number` (optional: compression quality 1-100)
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "url": "https://example.com/uploads/image123.jpg",
    "thumbnailUrl": "https://example.com/uploads/thumbnails/image123.jpg",
    "filename": "image123.jpg",
    "originalName": "iphone-photo.jpg",
    "size": 2048576,
    "mimetype": "image/jpeg",
    "dimensions": {
      "width": 1200,
      "height": 800
    }
  }
}
```

### POST /upload/images
**Purpose**: Upload multiple images (product galleries)
**Role**: Authenticated users
**Headers**: `Authorization: Bearer {token}`
**Content-Type**: `multipart/form-data`
**Form Data**: `images: File[]` (max 10 files)
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "url": "https://example.com/uploads/image1.jpg",
      "thumbnailUrl": "https://example.com/uploads/thumbnails/image1.jpg",
      "filename": "image1.jpg",
      "size": 1024576
    },
    {
      "url": "https://example.com/uploads/image2.jpg",
      "thumbnailUrl": "https://example.com/uploads/thumbnails/image2.jpg",
      "filename": "image2.jpg",
      "size": 1536000
    }
  ],
  "uploaded": 2,
  "failed": 0
}
```

### DELETE /upload/image
**Purpose**: Delete uploaded image
**Role**: Authenticated users (own images only)
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "imageUrl": "https://example.com/uploads/image123.jpg"
}
```

---

## 🔧 ADMIN ENDPOINTS

### GET /admin/dashboard
**Purpose**: Admin dashboard overview with platform statistics
**Role**: Admin only
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "stats": {
      "totalUsers": 1250,
      "totalCustomers": 1100,
      "totalStoreOwners": 145,
      "totalStores": 180,
      "activeStores": 145,
      "pendingStores": 12,
      "totalProducts": 5680,
      "activeProducts": 5200,
      "totalOrders": 12450,
      "todayOrders": 45,
      "totalRevenue": 2500000.00,
      "monthlyRevenue": 185000.00,
      "platformCommission": 125000.00,
      "flaggedReviews": 5,
      "supportTickets": 23
    },
    "recentActivity": [
      {
        "type": "new_store_registration",
        "message": "New store 'متجر الأزياء' registered",
        "timestamp": "2023-06-08T10:30:00Z",
        "data": {
          "storeId": "60d5ecb8b392c123456789cd",
          "ownerName": "أحمد محمد"
        }
      },
      {
        "type": "order_issue",
        "message": "Customer complaint about order ORD-2023-001234",
        "timestamp": "2023-06-08T09:45:00Z",
        "priority": "high"
      }
    ],
    "topPerformingStores": [
      {
        "storeId": "60d5ecb8b392c123456789cd",
        "name": "متجر الإلكترونيات الحديثة",
        "revenue": 15000.00,
        "orders": 45
      }
    ]
  }
}
```

### GET /admin/stores/pending
**Purpose**: Get stores pending approval with owner details
**Role**: Admin only
**Headers**: `Authorization: Bearer {token}`
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "60d5ecb8b392c123456789cd",
      "name": "متجر الأزياء الجديد",
      "category": "fashion",
      "owner": {
        "_id": "60d5ecb8b392c123456789ab",
        "name": "سارة أحمد",
        "email": "sara@example.com",
        "phone": "+966501234567"
      },
      "businessLicense": "1234567890",
      "taxNumber": "300123456789003",
      "documents": [
        {
          "type": "business_license",
          "url": "https://example.com/license.pdf"
        },
        {
          "type": "tax_certificate",
          "url": "https://example.com/tax.pdf"
        }
      ],
      "submittedAt": "2023-06-08T10:30:00Z",
      "reviewNotes": ""
    }
  ]
}
```

### PATCH /admin/stores/:storeId/approve
**Purpose**: Approve pending store
**Role**: Admin only
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "welcomeMessage": "مرحباً بك في منصتنا! نتمنى لك التوفيق",
  "setupInstructions": "يمكنك الآن البدء بإضافة منتجاتك"
}
```
**Success Response (200)**:
```json
{
  "success": true,
  "data": {
    "storeId": "60d5ecb8b392c123456789cd",
    "status": "approved",
    "approvedAt": "2023-06-08T11:00:00Z"
  },
  "message": "Store approved successfully. Owner has been notified."
}
```
**Backend Notification Trigger**: Notify store owner about approval:
```json
{
  "recipient": "store_owner_id",
  "type": "store_approved",
  "title": "تم قبول متجرك",
  "message": "تهانينا! تم قبول متجرك ويمكنك الآن البدء بالبيع",
  "data": {
    "storeId": "60d5ecb8b392c123456789cd",
    "storeName": "متجر الأزياء الجديد",
    "setupInstructions": "يمكنك الآن البدء بإضافة منتجاتك"
  },
  "priority": "high"
}
```

### PATCH /admin/stores/:storeId/reject
**Purpose**: Reject pending store with reason
**Role**: Admin only
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "reason": "Incomplete business documents",
  "details": "الرجاء إرفاق رخصة تجارية سارية المفعول",
  "requiredDocuments": ["business_license", "tax_certificate"],
  "canReapply": true
}
```

### GET /admin/users
**Purpose**: Get all users with filtering and management options
**Role**: Admin only
**Headers**: `Authorization: Bearer {token}`
**Query Parameters**:
- `role`: customer, store_owner, admin
- `status`: active, inactive, suspended
- `search`: string (name, email)
- `page`: number
- `limit`: number
**Success Response (200)**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "60d5ecb8b392c123456789ab",
      "name": "أحمد حسن",
      "email": "ahmed@example.com",
      "role": "store_owner",
      "isActive": true,
      "stores": [
        {
          "_id": "60d5ecb8b392c123456789cd",
          "name": "متجر الإلكترونيات",
          "status": "active"
        }
      ],
      "totalOrders": 156,
      "totalSpent": 45000.00,
      "lastLogin": "2023-06-08T10:30:00Z",
      "joinedAt": "2023-01-15T00:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 1250,
    "pages": 63
  }
}
```

### PATCH /admin/users/:userId/status
**Purpose**: Update user status (activate/deactivate/suspend)
**Role**: Admin only
**Headers**: `Authorization: Bearer {token}`
**Request Body**:
```json
{
  "status": "suspended", // active, inactive, suspended
  "reason": "Violating platform policies",
  "duration": "7d", // Optional: for temporary suspension
  "notifyUser": true
}
```

---

## 🎯 AUTOMATIC NOTIFICATION TRIGGERS

### Backend Implementation Requirements

The backend should automatically trigger notifications in these scenarios:

#### 1. Order Management Notifications

**When customer places order:**
```javascript
// Trigger for store owner
await createNotification({
  recipient: store.owner,
  type: "new_order",
  title: "طلب جديد",
  message: `لديك طلب جديد من ${customer.name} بقيمة ${order.finalTotal} ر.س`,
  data: {
    orderId: order._id,
    orderNumber: order.orderNumber,
    customerName: customer.name,
    amount: order.finalTotal,
    storeId: store._id,
    urgency: "high"
  },
  priority: "high",
  actionUrl: `/store-management?tab=orders&orderId=${order._id}`
});
```

**When store owner updates order status:**
```javascript
// Trigger for customer
await createNotification({
  recipient: order.customer,
  type: "order_status_update",
  title: getStatusTitle(newStatus),
  message: getStatusMessage(newStatus, order.orderNumber),
  data: {
    orderId: order._id,
    orderNumber: order.orderNumber,
    newStatus: newStatus,
    trackingNumber: order.trackingNumber,
    estimatedDelivery: order.estimatedDelivery
  },
  priority: newStatus === "shipped" ? "high" : "medium",
  actionUrl: `/orders/${order._id}`
});
```

#### 2. Inventory Management Notifications

**Low stock alert:**
```javascript
// Check after each sale
if (product.stock <= product.lowStockThreshold) {
  await createNotification({
    recipient: store.owner,
    type: "low_stock_alert",
    title: "تحذير: مخزون منخفض",
    message: `المنتج ${product.name} أوشك على النفاد (${product.stock} قطع متبقية)`,
    data: {
      productId: product._id,
      productName: product.name,
      currentStock: product.stock,
      threshold: product.lowStockThreshold
    },
    priority: "medium"
  });
}
```

#### 3. Review and Rating Notifications

**New review notification:**
```javascript
await createNotification({
  recipient: product.store.owner,
  type: "new_review",
  title: "تقييم جديد",
  message: `حصل منتجك ${product.name} على تقييم ${review.rating} نجوم`,
  data: {
    productId: product._id,
    productName: product.name,
    rating: review.rating,
    reviewId: review._id
  },
  priority: "medium"
});
```

#### 4. Delivery and Logistics Notifications

**Delivery status updates:**
```javascript
// When delivery company updates status
await createNotification({
  recipient: order.customer,
  type: "delivery_update",
  title: "تحديث حالة التوصيل",
  message: `طلبك في الطريق وسيصل خلال ${estimatedTime}`,
  data: {
    orderId: order._id,
    trackingNumber: order.trackingNumber,
    deliveryStatus: "in_transit",
    estimatedArrival: estimatedTime
  },
  priority: "high"
});
```

---

## 🔒 AUTHENTICATION & AUTHORIZATION

### Token Management
- Access tokens expire in 24 hours
- Refresh tokens expire in 30 days
- Include `Authorization: Bearer {token}` header for protected endpoints
- Tokens should be stored securely in frontend (localStorage/sessionStorage)

### Role-Based Access Control

#### Customer Permissions:
- Browse products and stores
- Place and manage orders
- Add reviews and ratings
- Manage cart and wishlist
- View own order history
- Receive notifications

#### Store Owner Permissions:
- All customer permissions
- Create and manage multiple stores
- Add, edit, delete products
- View and manage store orders
- Update order statuses
- Configure delivery settings
- View store analytics
- Manage store reviews

#### Admin Permissions:
- All permissions
- Approve/reject stores
- Manage all users
- View platform analytics
- Handle disputes
- System configuration

---

## 📈 REAL-TIME FEATURES

### WebSocket Events (Recommended)
For better user experience, implement WebSocket connections for:

```javascript
// Socket.io event examples
socket.on('new_order', (data) => {
  // Show real-time order notification to store owner
});

socket.on('order_status_update', (data) => {
  // Update order status in real-time for customer
});

socket.on('low_stock_alert', (data) => {
  // Alert store owner about low stock
});

socket.on('delivery_update', (data) => {
  // Real-time delivery tracking updates
});
```

---

## 🚨 ERROR HANDLING

### Standard Error Response Format
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Required fields are missing",
    "details": {
      "name": "Name is required",
      "email": "Valid email is required"
    },
    "field": "email", // For form validation
    "timestamp": "2023-06-08T10:30:00Z"
  }
}
```

### Business Logic Errors
```json
{
  "success": false,
  "error": {
    "code": "INSUFFICIENT_STOCK",
    "message": "Not enough items in stock",
    "details": {
      "requested": 5,
      "available": 2,
      "productId": "60d5ecb8b392c123456789ij"
    }
  }
}
```

### Common HTTP Status Codes
- `200`: Success
- `201`: Created
- `400`: Bad Request (validation errors)
- `401`: Unauthorized (invalid/expired token)
- `403`: Forbidden (insufficient permissions)
- `404`: Not Found
- `409`: Conflict (duplicate data)
- `422`: Unprocessable Entity (business logic errors)
- `429`: Too Many Requests (rate limiting)
- `500`: Internal Server Error

---

## 📋 BACKEND IMPLEMENTATION CHECKLIST

### Required Database Models

#### 1. User Model
```javascript
{
  _id: ObjectId,
  name: String,
  email: String (unique),
  password: String (hashed),
  role: Enum["customer", "store_owner", "admin"],
  stores: [ObjectId], // Array of store IDs for store owners
  phone: String,
  address: String,
  avatar: String,
  isActive: Boolean,
  emailVerified: Boolean,
  lastLogin: Date,
  createdAt: Date,
  updatedAt: Date
}
```

#### 2. Store Model
```javascript
{
  _id: ObjectId,
  name: String,
  description: String,
  category: String,
  logo: String,
  owner: ObjectId (ref: User),
  slug: String (unique),
  isActive: Boolean,
  isVerified: Boolean,
  businessLicense: String,
  taxNumber: String,
  deliverySettings: {
    freeDeliveryThreshold: Number,
    defaultDeliveryPrice: Number,
    deliveryAreas: [{
      name: String,
      price: Number,
      estimatedDays: Number
    }]
  },
  rating: Number,
  reviewsCount: Number,
  productsCount: Number,
  followersCount: Number,
  createdAt: Date,
  updatedAt: Date
}
```

#### 3. Product Model
```javascript
{
  _id: ObjectId,
  name: String,
  description: String,
  price: Number,
  originalPrice: Number,
  store: ObjectId (ref: Store),
  category: String,
  brand: String,
  images: [String],
  stock: Number,
  lowStockThreshold: Number (default: 10),
  specifications: Object,
  tags: [String],
  isActive: Boolean,
  rating: Number,
  reviewsCount: Number,
  views: Number,
  soldCount: Number,
  deliverySettings: {
    customDeliveryPrice: Number,
    expressDelivery: {
      available: Boolean,
      price: Number,
      estimatedDays: Number
    }
  },
  createdAt: Date,
  updatedAt: Date
}
```

#### 4. Order Model
```javascript
{
  _id: ObjectId,
  orderNumber: String (unique),
  customer: ObjectId (ref: User),
  store: ObjectId (ref: Store),
  items: [{
    product: ObjectId (ref: Product),
    quantity: Number,
    price: Number,
    deliveryOption: String
  }],
  status: Enum["pending", "confirmed", "preparing", "shipped", "delivered", "cancelled"],
  paymentStatus: Enum["pending", "paid", "failed", "refunded"],
  paymentMethod: String,
  shippingAddress: {
    fullName: String,
    phone: String,
    address: String,
    city: String,
    postalCode: String,
    country: String
  },
  totalAmount: Number,
  shippingCost: Number,
  taxAmount: Number,
  finalTotal: Number,
  trackingNumber: String,
  estimatedDelivery: Date,
  actualDelivery: Date,
  notes: String,
  statusHistory: [{
    status: String,
    timestamp: Date,
    note: String
  }],
  createdAt: Date,
  updatedAt: Date
}
```

#### 5. Notification Model
```javascript
{
  _id: ObjectId,
  recipient: ObjectId (ref: User),
  type: String,
  title: String,
  message: String,
  data: Object,
  isRead: Boolean,
  priority: Enum["low", "medium", "high"],
  actionUrl: String,
  createdAt: Date,
  readAt: Date
}
```

### Required Middleware
1. **Authentication Middleware**: Verify JWT tokens
2. **Authorization Middleware**: Check user roles and permissions
3. **Rate Limiting**: Prevent API abuse
4. **Image Upload Middleware**: Handle file uploads with validation
5. **Notification Middleware**: Trigger automatic notifications

### Required Services
1. **Email Service**: Send notifications and confirmations
2. **Image Processing Service**: Resize and optimize uploaded images
3. **Payment Service**: Handle payment processing
4. **Delivery Tracking Service**: Integrate with delivery companies
5. **Analytics Service**: Calculate statistics and reports

This comprehensive API documentation provides everything needed for seamless frontend-backend integration!
